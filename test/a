@SuppressWarnings("resource")
@Override
protected void execute(final Event e) {
	for (final String message : messages.getArray(e)) {
		if (files != null) {
			for (String s : files.getArray(e)) {
				s = s.toLowerCase();
				if (!s.endsWith(".log"))
					s += ".log";
				if (s.equals("server.log")) {
					SkriptLogger.LOGGER.log(Level.INFO, message);
					continue;
				}
				PrintWriter w = writers.get(s);
				if (w == null) {
					final File f = new File(logsFolder, s); // REMIND what if s contains '..'?
					try {
						f.getParentFile().mkdirs();
						w = new PrintWriter(new BufferedWriter(new FileWriter(f, true)));
						writers.put(s, w);
					} catch (final IOException ex) {
						Skript.error("Cannot write to log file '" + s + "' (" + f.getPath() + "): " + ExceptionUtils.toString(ex));
						return;
					}
				}
				w.println("[" + SkriptConfig.formatDate(System.currentTimeMillis()) + "] " + message);
				w.flush();
			}
		} else {
			final Trigger t = getTrigger();
			final File script = t == null ? null : t.getScript();
			Skript.info("[" + (script != null ? script.getName() : "---") + "] " + message);
		}
	}
}
